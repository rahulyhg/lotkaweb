{% extends 'admin/dashboard/main.twig' %} 

{% block title %}External Order Manager : Stripe{% endblock %} 

{% block contentHeader %}
<div id="content-header">
  <div id="breadcrumb">
    <a href="{{ path_for('admin.index') }}" title="Go to Home" class="tip-bottom"><i class="icon-home"></i> Home</a>
    <a href="{{ path_for('admin.orders.all') }}">Orders</a>
    <a href="{{ path_for('admin.orders.external') }}">External</a>
    <a href="#" class="current">TextTalk</a>
  </div>

  <h1>External Orders : TextTalk</h1>
</div>
{% endblock %} 

{% block content %}
<div class="container-fluid">
  <hr/>
  <div class="row-fluid">
    <div class="widget-box">
      <div class="widget-title"> <span class="icon"><i class="icon-ok"></i></span>
        <h5>Import Orders from TextTalk</h5>
      </div>
      <form action="{{ path_for('admin.orders.external.texttalk') }}" method="post">
      {{ csrf.field | raw }}
      <div class="widget-content">        
        <p>
          <button class="btn btn-primary btn-large" type="submit">
            Import selected orders <i class="icon-signin"></i>
          </button>
        </p>
<!--
        <ul class="unstyled">
          <li> <span class="icon24 icomoon-icon-arrow-up-2 green"></span> 0% Done <span class="pull-right strong">0</span>
            <div class="progress progress-striped ">
              <div style="width: 0%;" class="bar"></div>
            </div>
          </li>
        </ul>
//-->
        <table class="table table-bordered table-striped with-check">
          <thead>
            <tr>
              <th>#</th>
              <th><i class="icon-resize-vertical"></i></th>
              <th>SKU</th>
              <th>Participant</th>
              <th>Charged Amount</th>
              <th>Order Date</th>
            </tr>
          </thead>
          <tbody>

            {% for order in orders|reverse %}
            
            {% set lookup_key = "#{ order.type }#{ order.email }" %}
            {% set order_id = exising[lookup_key] %}
            {% set isSupporter = order.type == "SUPPORT" %}
            {% set origin = order.type == "STANDARD" and order.choices ? order.choices[0] : "" %}
            <tr>
              <td class="taskStatus">{{ loop.index }}</td>
              <td class="taskStatus">
                <input type="checkbox" {% if not order_id %}checked{% endif %} name="import[{{ loop.index0 }}]" value="{{ lookup_key }}">
                <input type="hidden" name="ticket_type[{{ loop.index0 }}]" value="{{order.type }}">
                <input type="hidden" name="email[{{ loop.index0 }}]" value="{{ order.email }}">
                <input type="hidden" name="amount[{{ loop.index0 }}]" value="{{ ticketTypes[order.type] }}">
                <input type="hidden" name="origin[{{ loop.index0 }}]" value="{{ origin|default('TextTalk') }}">
                <input type="hidden" name="orderdate[{{ loop.index0 }}]" value="{{ order.ordered }}">
                
                <input type="hidden" name="shirt_type[{{ loop.index0 }}]" value="{{ isSupporter ? order.choices[0] : '' }}">
                <input type="hidden" name="shirt_size[{{ loop.index0 }}]" value="{{ isSupporter ? order.choices[1] : '' }}">
                <input type="hidden" name="preference[{{ loop.index0 }}]" value="{{ isSupporter ? order.choices[3] : '' }}">
                <input type="hidden" name="surname[{{ loop.index0 }}]" value="{{ isSupporter ? order.choices[2] : '' }}">                
              </td>
              <td class="taskDesc">
                {{ order.type }}
              </td>
              <td class="taskDesc">
                {{ order.email }}
              </td>
              <td class="taskAmount">
                {{ ticketTypes[order.type]/100|number_format(2) }}SEK
              </td>
              <td class="taskDesc">
                {{ order.ordered|date }}
              </td>
            </tr>
            
          {% endfor %}
            
          </tbody>
        </table>
        
      </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}