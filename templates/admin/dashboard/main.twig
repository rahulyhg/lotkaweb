<!DOCTYPE html>
<html lang="en">
<head>
  <title>{% block title %}Lotka-Volterra Admin{% endblock %}</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/resources/admin/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/resources/admin/css/bootstrap-responsive.min.css" />
  <link rel="stylesheet" href="/resources/admin/css/fullcalendar.css" />
  <link rel="stylesheet" href="/resources/admin/css/matrix-style.css" />
  <link rel="stylesheet" href="/resources/admin/css/matrix-media.css" />
  <link rel="stylesheet" href="/resources/admin/css/select2.css" />
  <link rel="stylesheet" href="/resources/admin/css/uniform.css" />
  <link href="/resources/admin/font-awesome/css/font-awesome.css" rel="stylesheet" />
  <link rel="stylesheet" href="/resources/admin/css/jquery.gritter.css" />
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,800' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css?family=Pathway+Gothic+One" rel="stylesheet">
{% block header %}{% endblock %}  
</head>
<body>

<!--Header-part-->
<div id="header">
  <h1><a href="/admin">Lotka-Volterra</a></h1>
</div>
<!--close-Header-part--> 

<!--top-Header-menu-->
<div id="user-nav" class="navbar navbar-inverse">
  {% include 'admin/dashboard/partials/head-menu.html' %}
</div>
<!--close-top-Header-menu-->
  
<!--start-top-serch-->
<div id="search">
  <input type="text" placeholder="Search here..."/>
  <button type="submit" class="tip-bottom" title="Search"><i class="icon-search icon-white"></i></button>
</div>
<!--close-top-serch-->
  
<!--sidebar-menu-->
<div id="sidebar"><a href="#" class="visible-phone"><i class="icon icon-home"></i> Dashboard</a>
  {% include 'admin/dashboard/partials/side-menu.html' %}
</div>
<!--sidebar-menu-->

<!--main-container-part-->
  
<div id="content">
  {% block contentHeader %}
  <div id="content-header">
    <div id="breadcrumb"> <a href="index.html" title="Go to Home" class="tip-bottom"><i class="icon-home"></i> Home</a></div>
    <h1>Dashboard</h1>
  </div>
  {% endblock %}
  
  {% include 'admin/dashboard/partials/flash.twig' %}
  {% block content %}
    {% include 'admin/dashboard/widgets.html' %}
    {% include 'admin/dashboard/user_graph.html' %}
    {% include 'admin/dashboard/sales_graph.html' %}
  {% endblock %}
</div>

<!--end-main-container-part-->

<!--Footer-part-->

<div class="row-fluid">
  <div id="footer" class="span12"> 2013 &copy; Matrix Admin. Brought to you by <a href="http://themedesigner.in">Themedesigner.in</a> </div>
</div>

<!--end-Footer-part-->
{% block scripts %}
<script src="/resources/admin/js/excanvas.min.js"></script> 
<script src="/resources/admin/js/jquery.min.js"></script> 
<script src="/resources/admin/js/jquery.ui.custom.js"></script> 
<script src="/resources/admin/js/bootstrap.min.js"></script> 
<script src="/resources/admin/js/jquery.flot.min.js"></script> 
<script src="/resources/admin/js/jquery.flot.resize.min.js"></script> 
<script src="/resources/admin/js/jquery.flot.pie.min.js"></script>   
<script src="/resources/admin/js/jquery.peity.min.js"></script> 
<script src="/resources/admin/js/fullcalendar.min.js"></script> 
<script src="/resources/admin/js/matrix.js"></script> 
<script src="/resources/admin/js/matrix.dashboard.js"></script> 
<script src="/resources/admin/js/jquery.gritter.min.js"></script> 
<script src="/resources/admin/js/matrix.interface.js"></script> 
<script src="/resources/admin/js/matrix.chat.js"></script> 
<script src="/resources/admin/js/jquery.validate.js"></script> 
<script src="/resources/admin/js/matrix.form_validation.js"></script> 
<script src="/resources/admin/js/jquery.wizard.js"></script> 
<script src="/resources/admin/js/jquery.uniform.js"></script> 
<script src="/resources/admin/js/select2.min.js"></script> 
<script src="/resources/admin/js/matrix.popover.js"></script> 
<script src="/resources/admin/js/jquery.dataTables.min.js"></script> 
<script src="/resources/admin/js/matrix.tables.js"></script> 
<script src="/resources/admin/js/matrix.calendar.js"></script>
{% endblock %}
<script type="text/javascript">
  // This function is called from the pop-up menus to transfer to
  // a different page. Ignore if the value returned is a null string:
  function goPage (newURL) {

      // if url is empty, skip the menu dividers and reset the menu selection to default
      if (newURL != "") {
      
          // if url is "-", it is this page -- reset the menu:
          if (newURL == "-" ) {
              resetMenu();            
          } 
          // else, send page to designated URL            
          else {  
            document.location.href = newURL;
          }
      }
  }

// resets the menu selection upon entry to this page:
function resetMenu() {
   document.gomenu.selector.selectedIndex = 2;
}
{% block inlinejs %}{% endblock %}
</script>
  
<script type="text/javascript">
window.onload = function () {
  /*************************
  
  Pie charts
  
  *************************/
  
  var settings = {
    series: {
      pie: {
        show: true,
        radius: 1,
        label: {
          show: true,
          radius: 1,
          background: {
            opacity: 0.8,
            color: "#000"
          }
        }
      }
    }
  };
  
  var orders_attested_data = [
    {'label': "Unattested", 'data': {{ orderStatus.unattested }} },
    {'label': "Attested", 'data': {{ orderStatus.attested }} }
  ]; 
  $.plot('#orders_attested', orders_attested_data, settings);


  var users_onboarded_data = [
  {% for key in userStatus|keys %}
    {'label': "{{ key }}", 'data': {{ userStatus[key] }} }{{ loop.last ? '':',' }}
  {% endfor %}
  ]; 
  $.plot('#users_onboarded', users_onboarded_data, settings);
    
  
  
  /************************
  
  Sales charts
  
  ************************/
  
  function emptyDates() {
    var d = (new Date);
    var start_date = Date.parse("2017-08-25");
    var end_date = Date.parse([d.getFullYear(), d.getMonth()+1, d.getDate()].join('-'));
    var day_length = 24*60*60*1000;
    var days = Math.ceil((end_date - start_date)/day_length);
    var r = {};
    
    Array(days).fill(0).forEach(function (n,i) { 
      r[new Date(start_date + day_length * i).toISOString().substr(0,10)] = 0; 
    });
    
    return r;
  }
  
    window.datasets = {
        "STANDARD": {
            label: "Standard Ticket",
            data: emptyDates()
        },
        "SUPPORT": {
            label: "Supporter Ticket",
            data: emptyDates()
        },
        "STD_1": {
            label: "Standard, 1st payment",
            data: emptyDates()
        },
        "STD_2": {
            label: "Standard, 2nd payment",
            data: emptyDates()
        },
        "STD_3": {
            label: "Standard, 3nd payment",
            data: emptyDates()
        },
        "SUBSIDIZED": {
            label: "Subsidized Ticket",
            data: emptyDates()
        },
        "SUBSIDIZED_1": {
            label: "Subsidized Ticket, 1st payment",
            data: emptyDates()
        },      
        "SUBSIDIZED_2": {
            label: "Subsidized Ticket, 2nd payment",
            data: emptyDates()
        },      
        "LVTEST": {
            label: "Live Test Ticket",
            data: emptyDates()
        },      
        "ORG": {
            label: "Organizers",
            data: emptyDates()
        }
    }; 
  
{% for sale in sales %}
datasets['{{sale.TicketType}}'].data['{{sale.OrderDay}}'] = {{sale.Tickets}};
{% endfor %}

    // hard-code color indices to prevent them from shifting as
    // countries are turned on/off
    var i = 0, dataArr =[];
    $.each(datasets, function(key, val) {
      val.color = i;
      dataArr = [];
      $.each(val.data, function(key, val) {
        dataArr.push([Date.parse(key), val]);
      });
      val.data = dataArr;
      ++i;
    });
    
    // insert checkboxes 
    var choiceContainer = $("#choices");
    var default_hidden = ['LVTEST','ORG'];
    $.each(datasets, function(key, val) {
        choiceContainer.append('<br/><input type="checkbox" name="' + key +
                               '" ' + (default_hidden.indexOf(key) === -1 ? 'checked="checked"' : '')
                               + ' id="id' + key + '">' + '<label for="id' + key + '">'
                                + val.label + '</label>');
    });
    choiceContainer.find("input").click(plotAccordingToChoices);

    function plotAccordingToChoices() {
        var data = [];

        choiceContainer.find("input:checked").each(function () {
            var key = $(this).attr("name");
            if (key && datasets[key])
                data.push(datasets[key]);
        });

        if (data.length > 0)
            $.plot($("#placeholder"), data, {
                yaxis: { min: 0 },
                xaxis: { mode: "time" }
            });
    }

    plotAccordingToChoices();
 
};
</script>   
</body>
</html>
